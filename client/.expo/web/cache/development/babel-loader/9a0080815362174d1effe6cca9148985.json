{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\david\\\\Bootcamp\\\\DKoellerHomework\\\\Project3\\\\Project-3\\\\client\\\\providers\\\\auth.js\";\nimport React, { useMemo, useReducer, useContext } from 'react';\nimport AsyncStorage from \"react-native-web/dist/exports/AsyncStorage\";\nimport axios from \"axios\";\nimport reducer, { initialState, LOGGED_IN, LOGGED_OUT } from \"../reducer\";\nexport var TOKEN_KEY = 'token';\nexport var USER_KEY = 'user';\nexport var keys = [TOKEN_KEY, USER_KEY];\nvar AuthContext = React.createContext();\n\nfunction AuthProvider(props) {\n  var _useReducer = useReducer(reducer, initialState || {}),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      state = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  var getAuthState = function getAuthState() {\n    var token, user;\n    return _regeneratorRuntime.async(function getAuthState$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem(TOKEN_KEY));\n\n          case 3:\n            token = _context.sent;\n            _context.next = 6;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem(USER_KEY));\n\n          case 6:\n            user = _context.sent;\n            user = JSON.parse(user);\n\n            if (!(token !== null && user !== null)) {\n              _context.next = 13;\n              break;\n            }\n\n            _context.next = 11;\n            return _regeneratorRuntime.awrap(handleLogin({\n              token: token,\n              user: user\n            }));\n\n          case 11:\n            _context.next = 15;\n            break;\n\n          case 13:\n            _context.next = 15;\n            return _regeneratorRuntime.awrap(handleLogout());\n\n          case 15:\n            return _context.abrupt(\"return\", {\n              token: token,\n              user: user\n            });\n\n          case 18:\n            _context.prev = 18;\n            _context.t0 = _context[\"catch\"](0);\n            throw new Error(_context.t0);\n\n          case 21:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 18]], Promise);\n  };\n\n  var handleLogin = function handleLogin(data) {\n    var token, user, data_;\n    return _regeneratorRuntime.async(function handleLogin$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            token = data.token, user = data.user;\n            data_ = [[USER_KEY, JSON.stringify(user)], [TOKEN_KEY, token]];\n            _context2.next = 5;\n            return _regeneratorRuntime.awrap(AsyncStorage.multiSet(data_));\n\n          case 5:\n            axios.defaults.headers.common[\"Authorization\"] = \"Bearer \" + data.token;\n            dispatch({\n              type: LOGGED_IN,\n              user: data.user\n            });\n            _context2.next = 12;\n            break;\n\n          case 9:\n            _context2.prev = 9;\n            _context2.t0 = _context2[\"catch\"](0);\n            throw new Error(_context2.t0);\n\n          case 12:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 9]], Promise);\n  };\n\n  var handleLogout = function handleLogout() {\n    return _regeneratorRuntime.async(function handleLogout$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.multiRemove(keys));\n\n          case 3:\n            delete axios.defaults.headers.common[\"Authorization\"];\n            dispatch({\n              type: LOGGED_OUT\n            });\n            _context3.next = 10;\n            break;\n\n          case 7:\n            _context3.prev = 7;\n            _context3.t0 = _context3[\"catch\"](0);\n            throw new Error(_context3.t0);\n\n          case 10:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  var updateUser = function updateUser(user) {\n    return _regeneratorRuntime.async(function updateUser$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.prev = 0;\n            _context4.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(USER_KEY, JSON.stringify(user)));\n\n          case 3:\n            dispatch({\n              type: LOGGED_IN,\n              user: user\n            });\n            _context4.next = 9;\n            break;\n\n          case 6:\n            _context4.prev = 6;\n            _context4.t0 = _context4[\"catch\"](0);\n            throw new Error(_context4.t0);\n\n          case 9:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, [[0, 6]], Promise);\n  };\n\n  var value = useMemo(function () {\n    return {\n      state: state,\n      getAuthState: getAuthState,\n      handleLogin: handleLogin,\n      handleLogout: handleLogout,\n      updateUser: updateUser\n    };\n  }, [state]);\n  return React.createElement(AuthContext.Provider, {\n    value: value,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 9\n    }\n  }, props.children);\n}\n\nvar useAuth = function useAuth() {\n  return useContext(AuthContext);\n};\n\nexport { AuthContext, useAuth };\nexport default AuthProvider;","map":{"version":3,"sources":["C:/Users/david/Bootcamp/DKoellerHomework/Project3/Project-3/client/providers/auth.js"],"names":["React","useMemo","useReducer","useContext","axios","reducer","initialState","LOGGED_IN","LOGGED_OUT","TOKEN_KEY","USER_KEY","keys","AuthContext","createContext","AuthProvider","props","state","dispatch","getAuthState","AsyncStorage","getItem","token","user","JSON","parse","handleLogin","handleLogout","Error","data","data_","stringify","multiSet","defaults","headers","common","type","multiRemove","updateUser","setItem","value","children","useAuth"],"mappings":"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","sourcesContent":["import React, {useMemo, useReducer, useContext} from 'react';\nimport {AsyncStorage} from \"react-native\";\nimport axios from \"axios\";\n\n//IMPORT REDUCER, INITIAL STATE AND ACTION TYPES\nimport reducer, {initialState, LOGGED_IN, LOGGED_OUT} from \"../reducer\";\n\n// CONFIG KEYS [Storage Keys]===================================\nexport const TOKEN_KEY = 'token';\nexport const USER_KEY = 'user';\nexport const keys = [TOKEN_KEY, USER_KEY];\n\n// CONTEXT ===================================\nconst AuthContext = React.createContext();\n\nfunction AuthProvider(props) {\n    const [state, dispatch] = useReducer(reducer, initialState || {});\n\n    // Get Auth state\n    const getAuthState = async () => {\n        try {\n            //GET TOKEN && USER\n            let token = await AsyncStorage.getItem(TOKEN_KEY);\n            let user = await AsyncStorage.getItem(USER_KEY);\n            user = JSON.parse(user);\n\n            if (token !== null && user!== null) await handleLogin({token, user});\n            else await handleLogout();\n\n            return {token, user};\n        } catch (error) {\n            throw new Error(error)\n        }\n    };\n\n    // Handle Login\n    const handleLogin = async (data) => {\n        try{\n            //STORE DATA\n            let {token, user} = data;\n            let data_ = [[USER_KEY, JSON.stringify(user)], [TOKEN_KEY, token]];\n            await AsyncStorage.multiSet(data_);\n\n            //AXIOS AUTHORIZATION HEADER\n            axios.defaults.headers.common[\"Authorization\"] = `Bearer ${data.token}`;\n\n            //DISPATCH TO REDUCER\n            dispatch({type: LOGGED_IN, user:data.user});\n        }catch (error) {\n            throw new Error(error);\n        }\n    };\n\n    // Handle Logout\n    const handleLogout = async () => {\n        try{\n\n            //REMOVE DATA\n            await AsyncStorage.multiRemove(keys);\n\n            //AXIOS AUTHORIZATION HEADER\n            delete axios.defaults.headers.common[\"Authorization\"];\n\n            //DISPATCH TO REDUCER\n            dispatch({type: LOGGED_OUT});\n        }catch (error) {\n            throw new Error(error);\n        }\n    };\n\n    //UPDATE USER LOCAL STORAGE DATA AND DISPATCH TO REDUCER\n    const updateUser = async (user) => {\n        try {\n            await AsyncStorage.setItem(USER_KEY, JSON.stringify(user));\n            dispatch({type: LOGGED_IN, user}); //DISPATCH TO REDUCER\n        } catch (error) {\n            throw new Error(error);\n        }\n    };\n\n    const value = useMemo(() => {\n        return {state, getAuthState, handleLogin, handleLogout, updateUser};\n    }, [state]);\n\n    return (\n        <AuthContext.Provider value={value}>\n            {props.children}\n        </AuthContext.Provider>\n    );\n}\n\nconst useAuth = () => useContext(AuthContext);\nexport { AuthContext, useAuth }\nexport default AuthProvider;\n"]},"metadata":{},"sourceType":"module"}