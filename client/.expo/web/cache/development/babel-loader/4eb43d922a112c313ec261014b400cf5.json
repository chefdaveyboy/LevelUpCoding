{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/Users/rachael-andrew/Bootcamp/Project-3:AuthAPI/project-3/client/providers/auth.js\";\nimport React, { useMemo, useReducer, useContext } from 'react';\nimport AsyncStorage from \"react-native-web/dist/exports/AsyncStorage\";\nimport axios from 'axios';\nimport reducer, { initialState, LOGGED_IN, LOGGED_OUT } from \"./reducer\";\nexport var TOKEN_KEY = 'token';\nexport var USER_KEY = 'user';\nexport var keys = [TOKEY_KEY, USER_KEY];\nvar AuthContext = React.createContext();\n\nfunction AuthProvider(props) {\n  var _useReducer = useReducer(reducer, initialState || {}),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      state = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  var getAuthState = function getAuthState() {\n    var token, user;\n    return _regeneratorRuntime.async(function getAuthState$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.getIntem(TOKEN_KEY));\n\n          case 3:\n            token = _context.sent;\n            _context.next = 6;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem(USER_KEY));\n\n          case 6:\n            user = _context.sent;\n            user = JSON.parse(user);\n\n            if (!(token !== null && user !== null)) {\n              _context.next = 13;\n              break;\n            }\n\n            _context.next = 11;\n            return _regeneratorRuntime.awrap(handleLogin({\n              token: token,\n              user: user\n            }));\n\n          case 11:\n            _context.next = 15;\n            break;\n\n          case 13:\n            _context.next = 15;\n            return _regeneratorRuntime.awrap(handleLogout());\n\n          case 15:\n            return _context.abrupt(\"return\", {\n              token: token,\n              user: user\n            });\n\n          case 18:\n            _context.prev = 18;\n            _context.t0 = _context[\"catch\"](0);\n            throw new Error(_context.t0);\n\n          case 21:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 18]], Promise);\n  };\n\n  var handleLogin = function handleLogin(data) {\n    var token, user, data_;\n    return _regeneratorRuntime.async(function handleLogin$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            token = data.token, user = data.user;\n            data_ = [[USER_KEY, JSON.stringify(user)], [TOKEN_KEY, token]];\n            _context2.next = 5;\n            return _regeneratorRuntime.awrap(AsyncStorage.multiSet(data_));\n\n          case 5:\n            axios.defaults.headers.commaon[\"Authorization\"] = \"Bearer \" + data.token;\n            dispatch({\n              type: LOGGED_IN,\n              user: data.user\n            });\n            _context2.next = 12;\n            break;\n\n          case 9:\n            _context2.prev = 9;\n            _context2.t0 = _context2[\"catch\"](0);\n            throw new Error(_context2.t0);\n\n          case 12:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 9]], Promise);\n  };\n\n  var handleLogout = function handleLogout() {\n    return _regeneratorRuntime.async(function handleLogout$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.multiRemove(keys));\n\n          case 3:\n            delete axios.defaults.headers.common[\"Authorization\"];\n            dispatch({\n              type: LOGGED_OUT\n            });\n            _context3.next = 10;\n            break;\n\n          case 7:\n            _context3.prev = 7;\n            _context3.t0 = _context3[\"catch\"](0);\n            throw new Error(_context3.t0);\n\n          case 10:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  var updateUser = function updateUser(user) {\n    return _regeneratorRuntime.async(function updateUser$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.prev = 0;\n            _context4.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(USER_KEY, JSON.stringify(user)));\n\n          case 3:\n            dispatch({\n              type: LOGGED_IN,\n              user: user\n            });\n            _context4.next = 9;\n            break;\n\n          case 6:\n            _context4.prev = 6;\n            _context4.t0 = _context4[\"catch\"](0);\n            throw new Error(_context4.t0);\n\n          case 9:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, [[0, 6]], Promise);\n  };\n\n  var value = useMemo(function () {\n    return {\n      state: state,\n      getAuthState: getAuthState,\n      handleLogin: handleLogin,\n      handleLogout: handleLogout,\n      updateUser: updateUser\n    };\n  }, [state]);\n  return React.createElement(AuthContext.Provider, {\n    value: value,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 9\n    }\n  }, props.children);\n}\n\nvar useAuth = function useAuth() {\n  return useContext(AuthContext);\n};\n\nexport { AuthContext, useAuth };\nexport default AuthProvider;","map":{"version":3,"sources":["/Users/rachael-andrew/Bootcamp/Project-3:AuthAPI/project-3/client/providers/auth.js"],"names":["React","useMemo","useReducer","useContext","axios","reducer","initialState","LOGGED_IN","LOGGED_OUT","TOKEN_KEY","USER_KEY","keys","TOKEY_KEY","AuthContext","createContext","AuthProvider","props","state","dispatch","getAuthState","AsyncStorage","getIntem","token","getItem","user","JSON","parse","handleLogin","handleLogout","Error","data","data_","stringify","multiSet","defaults","headers","commaon","type","multiRemove","common","updateUser","setItem","value","children","useAuth"],"mappings":"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","sourcesContent":["import React, {useMemo, useReducer, useContext} from 'react';\nimport {AsyncStorage} from 'react-native';\nimport axios from 'axios';\n\n// IMPORT REDUCER, INITIAL STATE, AND ACTION TYPES\nimport reducer, {initialState, LOGGED_IN, LOGGED_OUT} from './reducer';\n\n\n// CONFIG KEYS [storage keys] ===========\n\nexport const TOKEN_KEY = 'token';\nexport const USER_KEY = 'user';\nexport const keys = [TOKEY_KEY, USER_KEY];\n\n// CONTEXT ============\n\nconst AuthContext = React.createContext();\n\nfunction AuthProvider(props) {\n    const [state, dispatch] = useReducer(reducer, initialState || {});\n\n\n    // Get auth state \n    const getAuthState = async () => {\n        try {\n            // GET TOKEN && USER\n            let token = await AsyncStorage.getIntem(TOKEN_KEY);\n            let user = await AsyncStorage.getItem(USER_KEY);\n            user = JSON.parse(user);\n\n            if (token !== null && user !== null) await handleLogin({token, user});\n            else await handleLogout();\n\n            return {token, user};\n        } catch (error) {\n            throw new Error(error)\n        }\n    };\n\n    // Handle Login\n    const handleLogin = async (data) => {\n        try {\n            // STORE DATA \n            let {token, user} = data;\n            let data_ = [[USER_KEY, JSON.stringify(user)], [TOKEN_KEY, token]];\n            await AsyncStorage.multiSet(data_);\n\n            // AXIOS AUTH HEADER \n            axios.defaults.headers.commaon[\"Authorization\"] = `Bearer ${data.token}`;\n\n            // DISPATCH TO REDUCER\n            dispatch({type: LOGGED_IN, user: data.user});\n        } catch (error) {\n            throw new Error(error);\n        }\n    };\n\n    // Handle Logout\n    const handleLogout = async () => {\n        try {\n\n            // REMOVE DATA \n            await AsyncStorage.multiRemove(keys);\n\n            // AXIOS AUTHORIZATION HEADER \n            delete axios.defaults.headers.common[\"Authorization\"];\n\n            // DISPATCH TO REDUCER \n            dispatch({type: LOGGED_OUT});\n        } catch (error) {\n            throw new Error(error);\n        }\n    };\n\n    // UPDATE USER LOCAL STORAGE DATA AND DISPATCH TO REDUCER\n    const updateUser = async (user) => {\n        try {\n            await AsyncStorage.setItem(USER_KEY, JSON.stringify(user));\n            dispatch({type: LOGGED_IN, user}); \n            // DISPATCH TO REDUCER \n\n        } catch (error) {\n            throw new Error(error);\n        }\n    };\n\n    const value = useMemo(() => {\n        return {state, getAuthState, handleLogin, handleLogout, updateUser};\n    }, [state]);\n\n    return (\n        <AuthContext.Provider value={value}>\n            {props.children}\n        </AuthContext.Provider>\n    );\n}\n\nconst useAuth = () => useContext(AuthContext);\nexport { AuthContext, useAuth }\nexport default AuthProvider;"]},"metadata":{},"sourceType":"module"}